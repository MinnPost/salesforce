<?php

/**
 * @file
 * Pull updates from Salesforce when a Salesforce object is updated.
 */

use Drupal\salesforce\Rest\RestClient;
use Drupal\salesforce_pull\QueueHandler;
use Drupal\salesforce_pull\DeleteHandler;

/**
 * Implements hook_cron().
 */
function salesforce_pull_cron() {
  $sfapi = \Drupal::service('salesforce.client');
  if ($sfapi->isAuthorized()) {
    QueueHandler::create(
      $sfapi,
      \Drupal::service('salesforce.salesforce_mapping_storage')->loadMultiple(),
      \Drupal::queue('cron_salesforce_pull')
    )->getUpdatedRecords();
    DeleteHandler::create(
      $sfapi,
      \Drupal::service('salesforce.salesforce_mapping_storage'),
      \Drupal::service('salesforce.mapped_object_storage')
    )->processDeletedRecords();
  }
}
